"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/recommendations/route";
exports.ids = ["app/api/recommendations/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

module.exports = require("child_process");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frecommendations%2Froute&page=%2Fapi%2Frecommendations%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frecommendations%2Froute.ts&appDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frecommendations%2Froute&page=%2Fapi%2Frecommendations%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frecommendations%2Froute.ts&appDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \*************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _home_spectre_rosamund_Documents_ubuntu_THERAMUSERX_next_js_app_api_recommendations_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/recommendations/route.ts */ \"(rsc)/./app/api/recommendations/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/recommendations/route\",\n        pathname: \"/api/recommendations\",\n        filename: \"route\",\n        bundlePath: \"app/api/recommendations/route\"\n    },\n    resolvedPagePath: \"/home/spectre-rosamund/Documents/ubuntu/*THERAMUSERX/next_js/app/api/recommendations/route.ts\",\n    nextConfigOutput,\n    userland: _home_spectre_rosamund_Documents_ubuntu_THERAMUSERX_next_js_app_api_recommendations_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/recommendations/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZyZWNvbW1lbmRhdGlvbnMlMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRnJlY29tbWVuZGF0aW9ucyUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRnJlY29tbWVuZGF0aW9ucyUyRnJvdXRlLnRzJmFwcERpcj0lMkZob21lJTJGc3BlY3RyZS1yb3NhbXVuZCUyRkRvY3VtZW50cyUyRnVidW50dSUyRipUSEVSQU1VU0VSWCUyRm5leHRfanMlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRmhvbWUlMkZzcGVjdHJlLXJvc2FtdW5kJTJGRG9jdW1lbnRzJTJGdWJ1bnR1JTJGKlRIRVJBTVVTRVJYJTJGbmV4dF9qcyZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD0mcHJlZmVycmVkUmVnaW9uPSZtaWRkbGV3YXJlQ29uZmlnPWUzMCUzRCEiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7O0FBQXNHO0FBQ3ZDO0FBQ2M7QUFDNkM7QUFDMUg7QUFDQTtBQUNBO0FBQ0Esd0JBQXdCLGdIQUFtQjtBQUMzQztBQUNBLGNBQWMseUVBQVM7QUFDdkI7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDQTtBQUNBLFlBQVk7QUFDWixDQUFDO0FBQ0Q7QUFDQTtBQUNBO0FBQ0EsUUFBUSxpRUFBaUU7QUFDekU7QUFDQTtBQUNBLFdBQVcsNEVBQVc7QUFDdEI7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUN1SDs7QUFFdkgiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aGVyYW11c2UtbmV4dGpzLz9kZGY5Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIi9ob21lL3NwZWN0cmUtcm9zYW11bmQvRG9jdW1lbnRzL3VidW50dS8qVEhFUkFNVVNFUlgvbmV4dF9qcy9hcHAvYXBpL3JlY29tbWVuZGF0aW9ucy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvcmVjb21tZW5kYXRpb25zL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvcmVjb21tZW5kYXRpb25zXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9yZWNvbW1lbmRhdGlvbnMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvaG9tZS9zcGVjdHJlLXJvc2FtdW5kL0RvY3VtZW50cy91YnVudHUvKlRIRVJBTVVTRVJYL25leHRfanMvYXBwL2FwaS9yZWNvbW1lbmRhdGlvbnMvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL3JlY29tbWVuZGF0aW9ucy9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frecommendations%2Froute&page=%2Fapi%2Frecommendations%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frecommendations%2Froute.ts&appDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/recommendations/route.ts":
/*!******************************************!*\
  !*** ./app/api/recommendations/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _barrel_optimize_names_differenceInYears_parseISO_date_fns__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! __barrel_optimize__?names=differenceInYears,parseISO!=!date-fns */ \"(rsc)/./node_modules/date-fns/differenceInYears.mjs\");\n/* harmony import */ var _barrel_optimize_names_differenceInYears_parseISO_date_fns__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! __barrel_optimize__?names=differenceInYears,parseISO!=!date-fns */ \"(rsc)/./node_modules/date-fns/parseISO.mjs\");\n/* harmony import */ var _lib_server_theramuse__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/server/theramuse */ \"(rsc)/./lib/server/theramuse.ts\");\n\n\n\nconst dynamic = \"force-dynamic\";\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const intake = body?.intake;\n        if (!intake) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Missing intake payload.\"\n            }, {\n                status: 400\n            });\n        }\n        const { patientInfo, patientSummary, bigFive } = transformIntake(intake);\n        const patientId = patientSummary.patientId;\n        const pythonPayload = {\n            action: \"recommend\",\n            data: {\n                patient_info: patientInfo,\n                condition: intake.condition,\n                patient_id: patientId\n            },\n            db_path: process.env.THERAMUSE_DB_PATH,\n            model_path: process.env.THERAMUSE_MODEL_PATH\n        };\n        const result = await (0,_lib_server_theramuse__WEBPACK_IMPORTED_MODULE_1__.runTheraMuse)(pythonPayload);\n        const recommendations = result?.recommendations;\n        if (!recommendations) {\n            throw new Error(\"TheraMuse did not return recommendations.\");\n        }\n        const sessionId = recommendations.session_id ?? \"session_unknown\";\n        const response = {\n            recommendations,\n            patientSummary: {\n                ...patientSummary,\n                sessionId\n            },\n            patientInfo,\n            bigFive\n        };\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(response);\n    } catch (error) {\n        console.error(\"Recommendation API error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: error instanceof Error ? error.message : \"Failed to generate recommendations.\"\n        }, {\n            status: 500\n        });\n    }\n}\nfunction transformIntake(intake) {\n    const birthDate = parseIsoDate(intake.dateOfBirth);\n    const birthYear = birthDate?.getFullYear();\n    const age = birthDate ? Math.max((0,_barrel_optimize_names_differenceInYears_parseISO_date_fns__WEBPACK_IMPORTED_MODULE_2__.differenceInYears)(new Date(), birthDate), 0) : 0;\n    const bigFive = computeBigFive(intake.bigFiveResponses);\n    const patientInfo = {\n        name: intake.name,\n        sex: intake.sex,\n        age,\n        birth_year: birthYear,\n        birthplace_city: intake.birthplaceCity,\n        birthplace_country: intake.birthplaceCountry,\n        condition: intake.condition,\n        instruments: intake.instruments,\n        preferred_languages: intake.preferredLanguages,\n        favorite_genre: intake.favoriteGenres.join(\", \"),\n        favorite_musician: intake.favoriteMusician,\n        favorite_season: intake.favoriteSeason,\n        natural_elements: intake.naturalElements,\n        difficulty_sleeping: intake.difficultySleeping,\n        trouble_remembering: intake.troubleRemembering,\n        forgets_everyday_things: intake.forgetsEverydayThings,\n        difficulty_recalling_old_memories: intake.difficultyRecallingOldMemories,\n        memory_worse_than_year_ago: intake.memoryWorseThanYearAgo,\n        visited_mental_health_professional: intake.visitedMentalHealthProfessional,\n        big5_scores: bigFive\n    };\n    const patientSummary = {\n        patientId: generatePatientId(),\n        sessionId: \"\",\n        name: intake.name,\n        age,\n        sex: intake.sex,\n        condition: intake.condition,\n        birthplaceCity: intake.birthplaceCity,\n        birthplaceCountry: intake.birthplaceCountry\n    };\n    return {\n        patientInfo,\n        patientSummary,\n        bigFive\n    };\n}\nfunction computeBigFive(responses) {\n    const reverse = (value)=>8 - value;\n    const padded = [\n        ...responses\n    ];\n    while(padded.length < 10){\n        padded.push(4);\n    }\n    const [q1, q2, q3, q4, q5, q6, q7, q8, q9, q10] = padded;\n    const openness = average(q5, reverse(q10));\n    const conscientiousness = average(q3, reverse(q8));\n    const extraversion = average(q1, reverse(q6));\n    const agreeableness = average(reverse(q2), q7);\n    const neuroticism = average(q4, reverse(q9));\n    return {\n        openness,\n        conscientiousness,\n        extraversion,\n        agreeableness,\n        neuroticism\n    };\n}\nfunction average(...values) {\n    const valid = values.filter((value)=>Number.isFinite(value));\n    if (!valid.length) return 0;\n    const sum = valid.reduce((total, value)=>total + value, 0);\n    return Number((sum / valid.length).toFixed(2));\n}\nfunction parseIsoDate(value) {\n    if (!value) return null;\n    try {\n        return (0,_barrel_optimize_names_differenceInYears_parseISO_date_fns__WEBPACK_IMPORTED_MODULE_3__.parseISO)(value);\n    } catch  {\n        return null;\n    }\n}\nfunction generatePatientId() {\n    return `patient_${Date.now()}`;\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFPdUIsT0FBTyxDQUFDRSxNQUFNSixNQUFNbkIsTUFBTSxFQUFFMEIsT0FBTyxDQUFDO0FBQzdDO0FBRUEsU0FBU3pFLGFBQWE2QyxLQUF5QjtJQUM3QyxJQUFJLENBQUNBLE9BQU8sT0FBTztJQUNuQixJQUFJO1FBQ0YsT0FBT2pGLG9HQUFRQSxDQUFDaUY7SUFDbEIsRUFBRSxPQUFNO1FBQ04sT0FBTztJQUNUO0FBQ0Y7QUFFQSxTQUFTSDtJQUNQLE9BQU8sQ0FBQyxRQUFRLEVBQUVuQyxLQUFLbUUsR0FBRyxHQUFHLENBQUM7QUFDaEMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aGVyYW11c2UtbmV4dGpzLy4vYXBwL2FwaS9yZWNvbW1lbmRhdGlvbnMvcm91dGUudHM/NDRhYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInXG5pbXBvcnQgeyBkaWZmZXJlbmNlSW5ZZWFycywgcGFyc2VJU08gfSBmcm9tICdkYXRlLWZucydcblxuaW1wb3J0IHR5cGUgeyBCaWdGaXZlU2NvcmVzLCBJbnRha2VGb3JtVmFsdWVzLCBSZWNvbW1lbmRhdGlvblBheWxvYWQsIFBhdGllbnRTdW1tYXJ5IH0gZnJvbSAnQC9saWIvdHlwZXMnXG5pbXBvcnQgeyBydW5UaGVyYU11c2UgfSBmcm9tICdAL2xpYi9zZXJ2ZXIvdGhlcmFtdXNlJ1xuXG5leHBvcnQgY29uc3QgZHluYW1pYyA9ICdmb3JjZS1keW5hbWljJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gUE9TVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0Lmpzb24oKVxuICAgIGNvbnN0IGludGFrZSA9IGJvZHk/LmludGFrZSBhcyBJbnRha2VGb3JtVmFsdWVzIHwgdW5kZWZpbmVkXG5cbiAgICBpZiAoIWludGFrZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIGludGFrZSBwYXlsb2FkLicgfSwgeyBzdGF0dXM6IDQwMCB9KVxuICAgIH1cblxuICAgIGNvbnN0IHsgcGF0aWVudEluZm8sIHBhdGllbnRTdW1tYXJ5LCBiaWdGaXZlIH0gPSB0cmFuc2Zvcm1JbnRha2UoaW50YWtlKVxuICAgIGNvbnN0IHBhdGllbnRJZCA9IHBhdGllbnRTdW1tYXJ5LnBhdGllbnRJZFxuXG4gICAgY29uc3QgcHl0aG9uUGF5bG9hZCA9IHtcbiAgICAgIGFjdGlvbjogJ3JlY29tbWVuZCcsXG4gICAgICBkYXRhOiB7XG4gICAgICAgIHBhdGllbnRfaW5mbzogcGF0aWVudEluZm8sXG4gICAgICAgIGNvbmRpdGlvbjogaW50YWtlLmNvbmRpdGlvbixcbiAgICAgICAgcGF0aWVudF9pZDogcGF0aWVudElkLFxuICAgICAgfSxcbiAgICAgIGRiX3BhdGg6IHByb2Nlc3MuZW52LlRIRVJBTVVTRV9EQl9QQVRILFxuICAgICAgbW9kZWxfcGF0aDogcHJvY2Vzcy5lbnYuVEhFUkFNVVNFX01PREVMX1BBVEgsXG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgcnVuVGhlcmFNdXNlKHB5dGhvblBheWxvYWQpXG4gICAgY29uc3QgcmVjb21tZW5kYXRpb25zID0gcmVzdWx0Py5yZWNvbW1lbmRhdGlvbnMgYXMgUmVjb21tZW5kYXRpb25QYXlsb2FkIHwgdW5kZWZpbmVkXG5cbiAgICBpZiAoIXJlY29tbWVuZGF0aW9ucykge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGVyYU11c2UgZGlkIG5vdCByZXR1cm4gcmVjb21tZW5kYXRpb25zLicpXG4gICAgfVxuXG4gICAgY29uc3Qgc2Vzc2lvbklkID0gcmVjb21tZW5kYXRpb25zLnNlc3Npb25faWQgPz8gJ3Nlc3Npb25fdW5rbm93bidcblxuICAgIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgICAgcmVjb21tZW5kYXRpb25zLFxuICAgICAgcGF0aWVudFN1bW1hcnk6IHtcbiAgICAgICAgLi4ucGF0aWVudFN1bW1hcnksXG4gICAgICAgIHNlc3Npb25JZCxcbiAgICAgIH0sXG4gICAgICBwYXRpZW50SW5mbyxcbiAgICAgIGJpZ0ZpdmUsXG4gICAgfVxuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHJlc3BvbnNlKVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1JlY29tbWVuZGF0aW9uIEFQSSBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7XG4gICAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdGYWlsZWQgdG8gZ2VuZXJhdGUgcmVjb21tZW5kYXRpb25zLicsXG4gICAgICB9LFxuICAgICAgeyBzdGF0dXM6IDUwMCB9LFxuICAgIClcbiAgfVxufVxuXG5mdW5jdGlvbiB0cmFuc2Zvcm1JbnRha2UoaW50YWtlOiBJbnRha2VGb3JtVmFsdWVzKSB7XG4gIGNvbnN0IGJpcnRoRGF0ZSA9IHBhcnNlSXNvRGF0ZShpbnRha2UuZGF0ZU9mQmlydGgpXG4gIGNvbnN0IGJpcnRoWWVhciA9IGJpcnRoRGF0ZT8uZ2V0RnVsbFllYXIoKVxuICBjb25zdCBhZ2UgPSBiaXJ0aERhdGUgPyBNYXRoLm1heChkaWZmZXJlbmNlSW5ZZWFycyhuZXcgRGF0ZSgpLCBiaXJ0aERhdGUpLCAwKSA6IDBcblxuICBjb25zdCBiaWdGaXZlID0gY29tcHV0ZUJpZ0ZpdmUoaW50YWtlLmJpZ0ZpdmVSZXNwb25zZXMpXG5cbiAgY29uc3QgcGF0aWVudEluZm8gPSB7XG4gICAgbmFtZTogaW50YWtlLm5hbWUsXG4gICAgc2V4OiBpbnRha2Uuc2V4LFxuICAgIGFnZSxcbiAgICBiaXJ0aF95ZWFyOiBiaXJ0aFllYXIsXG4gICAgYmlydGhwbGFjZV9jaXR5OiBpbnRha2UuYmlydGhwbGFjZUNpdHksXG4gICAgYmlydGhwbGFjZV9jb3VudHJ5OiBpbnRha2UuYmlydGhwbGFjZUNvdW50cnksXG4gICAgY29uZGl0aW9uOiBpbnRha2UuY29uZGl0aW9uLFxuICAgIGluc3RydW1lbnRzOiBpbnRha2UuaW5zdHJ1bWVudHMsXG4gICAgcHJlZmVycmVkX2xhbmd1YWdlczogaW50YWtlLnByZWZlcnJlZExhbmd1YWdlcyxcbiAgICBmYXZvcml0ZV9nZW5yZTogaW50YWtlLmZhdm9yaXRlR2VucmVzLmpvaW4oJywgJyksXG4gICAgZmF2b3JpdGVfbXVzaWNpYW46IGludGFrZS5mYXZvcml0ZU11c2ljaWFuLFxuICAgIGZhdm9yaXRlX3NlYXNvbjogaW50YWtlLmZhdm9yaXRlU2Vhc29uLFxuICAgIG5hdHVyYWxfZWxlbWVudHM6IGludGFrZS5uYXR1cmFsRWxlbWVudHMsXG4gICAgZGlmZmljdWx0eV9zbGVlcGluZzogaW50YWtlLmRpZmZpY3VsdHlTbGVlcGluZyxcbiAgICB0cm91YmxlX3JlbWVtYmVyaW5nOiBpbnRha2UudHJvdWJsZVJlbWVtYmVyaW5nLFxuICAgIGZvcmdldHNfZXZlcnlkYXlfdGhpbmdzOiBpbnRha2UuZm9yZ2V0c0V2ZXJ5ZGF5VGhpbmdzLFxuICAgIGRpZmZpY3VsdHlfcmVjYWxsaW5nX29sZF9tZW1vcmllczogaW50YWtlLmRpZmZpY3VsdHlSZWNhbGxpbmdPbGRNZW1vcmllcyxcbiAgICBtZW1vcnlfd29yc2VfdGhhbl95ZWFyX2FnbzogaW50YWtlLm1lbW9yeVdvcnNlVGhhblllYXJBZ28sXG4gICAgdmlzaXRlZF9tZW50YWxfaGVhbHRoX3Byb2Zlc3Npb25hbDogaW50YWtlLnZpc2l0ZWRNZW50YWxIZWFsdGhQcm9mZXNzaW9uYWwsXG4gICAgYmlnNV9zY29yZXM6IGJpZ0ZpdmUsXG4gIH1cblxuICBjb25zdCBwYXRpZW50U3VtbWFyeTogUGF0aWVudFN1bW1hcnkgPSB7XG4gICAgcGF0aWVudElkOiBnZW5lcmF0ZVBhdGllbnRJZCgpLFxuICAgIHNlc3Npb25JZDogJycsXG4gICAgbmFtZTogaW50YWtlLm5hbWUsXG4gICAgYWdlLFxuICAgIHNleDogaW50YWtlLnNleCxcbiAgICBjb25kaXRpb246IGludGFrZS5jb25kaXRpb24sXG4gICAgYmlydGhwbGFjZUNpdHk6IGludGFrZS5iaXJ0aHBsYWNlQ2l0eSxcbiAgICBiaXJ0aHBsYWNlQ291bnRyeTogaW50YWtlLmJpcnRocGxhY2VDb3VudHJ5LFxuICB9XG5cbiAgcmV0dXJuIHsgcGF0aWVudEluZm8sIHBhdGllbnRTdW1tYXJ5LCBiaWdGaXZlIH1cbn1cblxuZnVuY3Rpb24gY29tcHV0ZUJpZ0ZpdmUocmVzcG9uc2VzOiBudW1iZXJbXSk6IEJpZ0ZpdmVTY29yZXMge1xuICBjb25zdCByZXZlcnNlID0gKHZhbHVlOiBudW1iZXIpID0+IDggLSB2YWx1ZVxuXG4gIGNvbnN0IHBhZGRlZCA9IFsuLi5yZXNwb25zZXNdXG4gIHdoaWxlIChwYWRkZWQubGVuZ3RoIDwgMTApIHtcbiAgICBwYWRkZWQucHVzaCg0KVxuICB9XG5cbiAgY29uc3QgW3ExLCBxMiwgcTMsIHE0LCBxNSwgcTYsIHE3LCBxOCwgcTksIHExMF0gPSBwYWRkZWRcblxuICBjb25zdCBvcGVubmVzcyA9IGF2ZXJhZ2UocTUsIHJldmVyc2UocTEwKSlcbiAgY29uc3QgY29uc2NpZW50aW91c25lc3MgPSBhdmVyYWdlKHEzLCByZXZlcnNlKHE4KSlcbiAgY29uc3QgZXh0cmF2ZXJzaW9uID0gYXZlcmFnZShxMSwgcmV2ZXJzZShxNikpXG4gIGNvbnN0IGFncmVlYWJsZW5lc3MgPSBhdmVyYWdlKHJldmVyc2UocTIpLCBxNylcbiAgY29uc3QgbmV1cm90aWNpc20gPSBhdmVyYWdlKHE0LCByZXZlcnNlKHE5KSlcblxuICByZXR1cm4ge1xuICAgIG9wZW5uZXNzLFxuICAgIGNvbnNjaWVudGlvdXNuZXNzLFxuICAgIGV4dHJhdmVyc2lvbixcbiAgICBhZ3JlZWFibGVuZXNzLFxuICAgIG5ldXJvdGljaXNtLFxuICB9XG59XG5cbmZ1bmN0aW9uIGF2ZXJhZ2UoLi4udmFsdWVzOiBudW1iZXJbXSkge1xuICBjb25zdCB2YWxpZCA9IHZhbHVlcy5maWx0ZXIoKHZhbHVlKSA9PiBOdW1iZXIuaXNGaW5pdGUodmFsdWUpKVxuICBpZiAoIXZhbGlkLmxlbmd0aCkgcmV0dXJuIDBcbiAgY29uc3Qgc3VtID0gdmFsaWQucmVkdWNlKCh0b3RhbCwgdmFsdWUpID0+IHRvdGFsICsgdmFsdWUsIDApXG4gIHJldHVybiBOdW1iZXIoKHN1bSAvIHZhbGlkLmxlbmd0aCkudG9GaXhlZCgyKSlcbn1cblxuZnVuY3Rpb24gcGFyc2VJc29EYXRlKHZhbHVlOiBzdHJpbmcgfCB1bmRlZmluZWQpIHtcbiAgaWYgKCF2YWx1ZSkgcmV0dXJuIG51bGxcbiAgdHJ5IHtcbiAgICByZXR1cm4gcGFyc2VJU08odmFsdWUpXG4gIH0gY2F0Y2gge1xuICAgIHJldHVybiBudWxsXG4gIH1cbn1cblxuZnVuY3Rpb24gZ2VuZXJhdGVQYXRpZW50SWQoKSB7XG4gIHJldHVybiBgcGF0aWVudF8ke0RhdGUubm93KCl9YFxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImRpZmZlcmVuY2VJblllYXJzIiwicGFyc2VJU08iLCJydW5UaGVyYU11c2UiLCJkeW5hbWljIiwiUE9TVCIsInJlcXVlc3QiLCJib2R5IiwianNvbiIsImludGFrZSIsImVycm9yIiwic3RhdHVzIiwicGF0aWVudEluZm8iLCJwYXRpZW50U3VtbWFyeSIsImJpZ0ZpdmUiLCJ0cmFuc2Zvcm1JbnRha2UiLCJwYXRpZW50SWQiLCJweXRob25QYXlsb2FkIiwiYWN0aW9uIiwiZGF0YSIsInBhdGllbnRfaW5mbyIsImNvbmRpdGlvbiIsInBhdGllbnRfaWQiLCJkYl9wYXRoIiwicHJvY2VzcyIsImVudiIsIlRIRVJBTVVTRV9EQl9QQVRIIiwibW9kZWxfcGF0aCIsIlRIRVJBTVVTRV9NT0RFTF9QQVRIIiwicmVzdWx0IiwicmVjb21tZW5kYXRpb25zIiwiRXJyb3IiLCJzZXNzaW9uSWQiLCJzZXNzaW9uX2lkIiwicmVzcG9uc2UiLCJjb25zb2xlIiwibWVzc2FnZSIsImJpcnRoRGF0ZSIsInBhcnNlSXNvRGF0ZSIsImRhdGVPZkJpcnRoIiwiYmlydGhZZWFyIiwiZ2V0RnVsbFllYXIiLCJhZ2UiLCJNYXRoIiwibWF4IiwiRGF0ZSIsImNvbXB1dGVCaWdGaXZlIiwiYmlnRml2ZVJlc3BvbnNlcyIsIm5hbWUiLCJzZXgiLCJiaXJ0aF95ZWFyIiwiYmlydGhwbGFjZV9jaXR5IiwiYmlydGhwbGFjZUNpdHkiLCJiaXJ0aHBsYWNlX2NvdW50cnkiLCJiaXJ0aHBsYWNlQ291bnRyeSIsImluc3RydW1lbnRzIiwicHJlZmVycmVkX2xhbmd1YWdlcyIsInByZWZlcnJlZExhbmd1YWdlcyIsImZhdm9yaXRlX2dlbnJlIiwiZmF2b3JpdGVHZW5yZXMiLCJqb2luIiwiZmF2b3JpdGVfbXVzaWNpYW4iLCJmYXZvcml0ZU11c2ljaWFuIiwiZmF2b3JpdGVfc2Vhc29uIiwiZmF2b3JpdGVTZWFzb24iLCJuYXR1cmFsX2VsZW1lbnRzIiwibmF0dXJhbEVsZW1lbnRzIiwiZGlmZmljdWx0eV9zbGVlcGluZyIsImRpZmZpY3VsdHlTbGVlcGluZyIsInRyb3VibGVfcmVtZW1iZXJpbmciLCJ0cm91YmxlUmVtZW1iZXJpbmciLCJmb3JnZXRzX2V2ZXJ5ZGF5X3RoaW5ncyIsImZvcmdldHNFdmVyeWRheVRoaW5ncyIsImRpZmZpY3VsdHlfcmVjYWxsaW5nX29sZF9tZW1vcmllcyIsImRpZmZpY3VsdHlSZWNhbGxpbmdPbGRNZW1vcmllcyIsIm1lbW9yeV93b3JzZV90aGFuX3llYXJfYWdvIiwibWVtb3J5V29yc2VUaGFuWWVhckFnbyIsInZpc2l0ZWRfbWVudGFsX2hlYWx0aF9wcm9mZXNzaW9uYWwiLCJ2aXNpdGVkTWVudGFsSGVhbHRoUHJvZmVzc2lvbmFsIiwiYmlnNV9zY29yZXMiLCJnZW5lcmF0ZVBhdGllbnRJZCIsInJlc3BvbnNlcyIsInJldmVyc2UiLCJ2YWx1ZSIsInBhZGRlZCIsImxlbmd0aCIsInB1c2giLCJxMSIsInEyIiwicTMiLCJxNCIsInE1IiwicTYiLCJxNyIsInE4IiwicTkiLCJxMTAiLCJvcGVubmVzcyIsImF2ZXJhZ2UiLCJjb25zY2llbnRpb3VzbmVzcyIsImV4dHJhdmVyc2lvbiIsImFncmVlYWJsZW5lc3MiLCJuZXVyb3RpY2lzbSIsInZhbHVlcyIsInZhbGlkIiwiZmlsdGVyIiwiTnVtYmVyIiwiaXNGaW5pdGUiLCJzdW0iLCJyZWR1Y2UiLCJ0b3RhbCIsInRvRml4ZWQiLCJub3ciXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/recommendations/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/server/theramuse.ts":
/*!*********************************!*\
  !*** ./lib/server/theramuse.ts ***!
  \*********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   runTheraMuse: () => (/* binding */ runTheraMuse)\n/* harmony export */ });\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! child_process */ \"child_process\");\n/* harmony import */ var child_process__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(child_process__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n\n\n\nasync function runTheraMuse(payload) {\n    const scriptPath = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"scripts\", \"theramuse_cli.py\");\n    const pythonBinary = resolvePythonBinary();\n    return new Promise((resolve, reject)=>{\n        const child = (0,child_process__WEBPACK_IMPORTED_MODULE_0__.spawn)(pythonBinary, [\n            scriptPath\n        ], {\n            cwd: process.cwd(),\n            env: {\n                ...process.env,\n                PYTHONUNBUFFERED: \"1\"\n            }\n        });\n        let stdout = \"\";\n        let stderr = \"\";\n        child.stdout.on(\"data\", (chunk)=>{\n            stdout += chunk.toString();\n        });\n        child.stderr.on(\"data\", (chunk)=>{\n            stderr += chunk.toString();\n        });\n        child.on(\"close\", (code)=>{\n            if (stderr.trim()) {\n                console.error(\"[TheraMuse stderr]\", stderr);\n            }\n            if (code !== 0) {\n                reject(new Error(stderr || `TheraMuse exited with code ${code}`));\n                return;\n            }\n            try {\n                const parsed = JSON.parse(stdout.trim());\n                if (parsed?.error) {\n                    reject(new Error(parsed.error));\n                } else {\n                    resolve(parsed);\n                }\n            } catch (error) {\n                reject(new Error(`Unable to parse TheraMuse response: ${stdout}`));\n            }\n        });\n        child.on(\"error\", (error)=>{\n            reject(error);\n        });\n        child.stdin.write(JSON.stringify(payload));\n        child.stdin.end();\n    });\n}\nfunction resolvePythonBinary() {\n    const fromEnv = process.env.THERAMUSE_PYTHON_BINARY;\n    if (fromEnv) {\n        return fromEnv;\n    }\n    const candidates = [\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"venv\", \"bin\", \"python\"),\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"venv\", \"Scripts\", \"python.exe\"),\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"theramusenv\", \"bin\", \"python\"),\n        path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"theramusenv\", \"Scripts\", \"python.exe\")\n    ];\n    for (const candidate of candidates){\n        if (fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(candidate)) {\n            return candidate;\n        }\n    }\n    return \"python3\";\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc2VydmVyL3RoZXJhbXVzZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQXFDO0FBQ2xCO0FBQ0k7QUFFaEIsZUFBZUcsYUFBYUMsT0FBZ0M7SUFDakUsTUFBTUMsYUFBYUgsZ0RBQVMsQ0FBQ0ssUUFBUUMsR0FBRyxJQUFJLFdBQVc7SUFDdkQsTUFBTUMsZUFBZUM7SUFFckIsT0FBTyxJQUFJQyxRQUFhLENBQUNDLFNBQVNDO1FBQ2hDLE1BQU1DLFFBQVFkLG9EQUFLQSxDQUFDUyxjQUFjO1lBQUNKO1NBQVcsRUFBRTtZQUM5Q0csS0FBS0QsUUFBUUMsR0FBRztZQUNoQk8sS0FBSztnQkFDSCxHQUFHUixRQUFRUSxHQUFHO2dCQUNkQyxrQkFBa0I7WUFDcEI7UUFDRjtRQUVBLElBQUlDLFNBQVM7UUFDYixJQUFJQyxTQUFTO1FBRWJKLE1BQU1HLE1BQU0sQ0FBQ0UsRUFBRSxDQUFDLFFBQVEsQ0FBQ0M7WUFDdkJILFVBQVVHLE1BQU1DLFFBQVE7UUFDMUI7UUFFQVAsTUFBTUksTUFBTSxDQUFDQyxFQUFFLENBQUMsUUFBUSxDQUFDQztZQUN2QkYsVUFBVUUsTUFBTUMsUUFBUTtRQUMxQjtRQUVBUCxNQUFNSyxFQUFFLENBQUMsU0FBUyxDQUFDRztZQUNqQixJQUFJSixPQUFPSyxJQUFJLElBQUk7Z0JBQ2pCQyxRQUFRQyxLQUFLLENBQUMsc0JBQXNCUDtZQUN0QztZQUNBLElBQUlJLFNBQVMsR0FBRztnQkFDZFQsT0FBTyxJQUFJYSxNQUFNUixVQUFVLENBQUMsMkJBQTJCLEVBQUVJLEtBQUssQ0FBQztnQkFDL0Q7WUFDRjtZQUNBLElBQUk7Z0JBQ0YsTUFBTUssU0FBU0MsS0FBS0MsS0FBSyxDQUFDWixPQUFPTSxJQUFJO2dCQUNyQyxJQUFJSSxRQUFRRixPQUFPO29CQUNqQlosT0FBTyxJQUFJYSxNQUFNQyxPQUFPRixLQUFLO2dCQUMvQixPQUFPO29CQUNMYixRQUFRZTtnQkFDVjtZQUNGLEVBQUUsT0FBT0YsT0FBTztnQkFDZFosT0FBTyxJQUFJYSxNQUFNLENBQUMsb0NBQW9DLEVBQUVULE9BQU8sQ0FBQztZQUNsRTtRQUNGO1FBRUFILE1BQU1LLEVBQUUsQ0FBQyxTQUFTLENBQUNNO1lBQ2pCWixPQUFPWTtRQUNUO1FBRUFYLE1BQU1nQixLQUFLLENBQUNDLEtBQUssQ0FBQ0gsS0FBS0ksU0FBUyxDQUFDNUI7UUFDakNVLE1BQU1nQixLQUFLLENBQUNHLEdBQUc7SUFDakI7QUFDRjtBQUVBLFNBQVN2QjtJQUNQLE1BQU13QixVQUFVM0IsUUFBUVEsR0FBRyxDQUFDb0IsdUJBQXVCO0lBQ25ELElBQUlELFNBQVM7UUFDWCxPQUFPQTtJQUNUO0lBRUEsTUFBTUUsYUFBYTtRQUNqQmxDLGdEQUFTLENBQUNLLFFBQVFDLEdBQUcsSUFBSSxRQUFRLE9BQU87UUFDeENOLGdEQUFTLENBQUNLLFFBQVFDLEdBQUcsSUFBSSxRQUFRLFdBQVc7UUFDNUNOLGdEQUFTLENBQUNLLFFBQVFDLEdBQUcsSUFBSSxlQUFlLE9BQU87UUFDL0NOLGdEQUFTLENBQUNLLFFBQVFDLEdBQUcsSUFBSSxlQUFlLFdBQVc7S0FDcEQ7SUFFRCxLQUFLLE1BQU02QixhQUFhRCxXQUFZO1FBQ2xDLElBQUluQyxvREFBYSxDQUFDb0MsWUFBWTtZQUM1QixPQUFPQTtRQUNUO0lBQ0Y7SUFFQSxPQUFPO0FBQ1QiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90aGVyYW11c2UtbmV4dGpzLy4vbGliL3NlcnZlci90aGVyYW11c2UudHM/MDkxMSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBzcGF3biB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnXG5pbXBvcnQgZnMgZnJvbSAnZnMnXG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gcnVuVGhlcmFNdXNlKHBheWxvYWQ6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KSB7XG4gIGNvbnN0IHNjcmlwdFBhdGggPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3NjcmlwdHMnLCAndGhlcmFtdXNlX2NsaS5weScpXG4gIGNvbnN0IHB5dGhvbkJpbmFyeSA9IHJlc29sdmVQeXRob25CaW5hcnkoKVxuXG4gIHJldHVybiBuZXcgUHJvbWlzZTxhbnk+KChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICBjb25zdCBjaGlsZCA9IHNwYXduKHB5dGhvbkJpbmFyeSwgW3NjcmlwdFBhdGhdLCB7XG4gICAgICBjd2Q6IHByb2Nlc3MuY3dkKCksXG4gICAgICBlbnY6IHtcbiAgICAgICAgLi4ucHJvY2Vzcy5lbnYsXG4gICAgICAgIFBZVEhPTlVOQlVGRkVSRUQ6ICcxJyxcbiAgICAgIH0sXG4gICAgfSlcblxuICAgIGxldCBzdGRvdXQgPSAnJ1xuICAgIGxldCBzdGRlcnIgPSAnJ1xuXG4gICAgY2hpbGQuc3Rkb3V0Lm9uKCdkYXRhJywgKGNodW5rKSA9PiB7XG4gICAgICBzdGRvdXQgKz0gY2h1bmsudG9TdHJpbmcoKVxuICAgIH0pXG5cbiAgICBjaGlsZC5zdGRlcnIub24oJ2RhdGEnLCAoY2h1bmspID0+IHtcbiAgICAgIHN0ZGVyciArPSBjaHVuay50b1N0cmluZygpXG4gICAgfSlcblxuICAgIGNoaWxkLm9uKCdjbG9zZScsIChjb2RlKSA9PiB7XG4gICAgICBpZiAoc3RkZXJyLnRyaW0oKSkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbVGhlcmFNdXNlIHN0ZGVycl0nLCBzdGRlcnIpXG4gICAgICB9XG4gICAgICBpZiAoY29kZSAhPT0gMCkge1xuICAgICAgICByZWplY3QobmV3IEVycm9yKHN0ZGVyciB8fCBgVGhlcmFNdXNlIGV4aXRlZCB3aXRoIGNvZGUgJHtjb2RlfWApKVxuICAgICAgICByZXR1cm5cbiAgICAgIH1cbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IHBhcnNlZCA9IEpTT04ucGFyc2Uoc3Rkb3V0LnRyaW0oKSlcbiAgICAgICAgaWYgKHBhcnNlZD8uZXJyb3IpIHtcbiAgICAgICAgICByZWplY3QobmV3IEVycm9yKHBhcnNlZC5lcnJvcikpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmVzb2x2ZShwYXJzZWQpXG4gICAgICAgIH1cbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIHJlamVjdChuZXcgRXJyb3IoYFVuYWJsZSB0byBwYXJzZSBUaGVyYU11c2UgcmVzcG9uc2U6ICR7c3Rkb3V0fWApKVxuICAgICAgfVxuICAgIH0pXG5cbiAgICBjaGlsZC5vbignZXJyb3InLCAoZXJyb3IpID0+IHtcbiAgICAgIHJlamVjdChlcnJvcilcbiAgICB9KVxuXG4gICAgY2hpbGQuc3RkaW4ud3JpdGUoSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkpXG4gICAgY2hpbGQuc3RkaW4uZW5kKClcbiAgfSlcbn1cblxuZnVuY3Rpb24gcmVzb2x2ZVB5dGhvbkJpbmFyeSgpIHtcbiAgY29uc3QgZnJvbUVudiA9IHByb2Nlc3MuZW52LlRIRVJBTVVTRV9QWVRIT05fQklOQVJZXG4gIGlmIChmcm9tRW52KSB7XG4gICAgcmV0dXJuIGZyb21FbnZcbiAgfVxuXG4gIGNvbnN0IGNhbmRpZGF0ZXMgPSBbXG4gICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd2ZW52JywgJ2JpbicsICdweXRob24nKSxcbiAgICBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3ZlbnYnLCAnU2NyaXB0cycsICdweXRob24uZXhlJyksXG4gICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd0aGVyYW11c2VudicsICdiaW4nLCAncHl0aG9uJyksXG4gICAgcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksICd0aGVyYW11c2VudicsICdTY3JpcHRzJywgJ3B5dGhvbi5leGUnKSxcbiAgXVxuXG4gIGZvciAoY29uc3QgY2FuZGlkYXRlIG9mIGNhbmRpZGF0ZXMpIHtcbiAgICBpZiAoZnMuZXhpc3RzU3luYyhjYW5kaWRhdGUpKSB7XG4gICAgICByZXR1cm4gY2FuZGlkYXRlXG4gICAgfVxuICB9XG5cbiAgcmV0dXJuICdweXRob24zJ1xufVxuIl0sIm5hbWVzIjpbInNwYXduIiwiZnMiLCJwYXRoIiwicnVuVGhlcmFNdXNlIiwicGF5bG9hZCIsInNjcmlwdFBhdGgiLCJqb2luIiwicHJvY2VzcyIsImN3ZCIsInB5dGhvbkJpbmFyeSIsInJlc29sdmVQeXRob25CaW5hcnkiLCJQcm9taXNlIiwicmVzb2x2ZSIsInJlamVjdCIsImNoaWxkIiwiZW52IiwiUFlUSE9OVU5CVUZGRVJFRCIsInN0ZG91dCIsInN0ZGVyciIsIm9uIiwiY2h1bmsiLCJ0b1N0cmluZyIsImNvZGUiLCJ0cmltIiwiY29uc29sZSIsImVycm9yIiwiRXJyb3IiLCJwYXJzZWQiLCJKU09OIiwicGFyc2UiLCJzdGRpbiIsIndyaXRlIiwic3RyaW5naWZ5IiwiZW5kIiwiZnJvbUVudiIsIlRIRVJBTVVTRV9QWVRIT05fQklOQVJZIiwiY2FuZGlkYXRlcyIsImNhbmRpZGF0ZSIsImV4aXN0c1N5bmMiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/server/theramuse.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/date-fns"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Frecommendations%2Froute&page=%2Fapi%2Frecommendations%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Frecommendations%2Froute.ts&appDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2Fhome%2Fspectre-rosamund%2FDocuments%2Fubuntu%2F*THERAMUSERX%2Fnext_js&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();